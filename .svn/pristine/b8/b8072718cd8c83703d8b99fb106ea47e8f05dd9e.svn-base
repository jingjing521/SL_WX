<!doctype html>
<html lang="en">

	<head>
		<meta charset="UTF-8">
		<meta content="width=device-width, minimum-scale=1,initial-scale=1, maximum-scale=1, user-scalable=1;" id="viewport" name="viewport" />
		<!--离线应用的另一个技巧-->
		<meta content="yes" name="apple-mobile-web-app-capable" />
		<!--指定的iphone中safari顶端的状态条的样式-->
		<meta content="black" name="apple-mobile-web-app-status-bar-style" />
		<!--告诉设备忽略将页面中的数字识别为电话号码-->
		<meta content="telephone=no" name="format-detection" />
		<title>筛选</title>
		<link rel="stylesheet" type="text/css" href="css/index.css" />
		<link rel="stylesheet" type="text/css" href="css/jquery-weui.css" />
		<link rel="stylesheet" type="text/css" href="css/weui.min.css" />
		<style>
			.weui_toast_text {width: 15em !important; margin: auto; min-height: 30px; border-radius: 5px;max-height: 200px; height: 43px !important;}
			.btn{position: fixed; bottom: 0;}		
		</style>
	</head>

	<body>
		<!-- 总体框架 -->
		<div class="index-bg">
			<div id="screening">
				<div class="tr screening-con-titles">重置</div>
				<div class="screening-con" data-attrval="">
					<div class="screening-con-title">品类</div>
					<div class="screening-con-items top">
					</div>
				</div>
				<div class="screening-con-b"></div>
				<div class="zw50"></div>
				<div class="btn">确定</div>
			</div>
		</div>
	</body>
	<script src="js/jquery-2.2.1.js"></script>
	<script src="js/center.js"></script>
	<script src="js/md5.js"></script>
	<script src="js/jquery-weui.js"></script>
	<script>
		$(document).ready(function(){
			
			var w=$(window).height();
			console.log(w);
			$("#screening").css("min-height",w-10);
			
			$(".screening-con-titles").click(function(){
				$(".screening-con").children().children().removeClass("active");
				$(".screening-con").children().children().removeClass("actives");
				$(".screening-con").children().children().removeClass("nn");
			})
			
			var shop_id=parseInt(parseUrl().id);
			console.log(shop_id)
			var timestamp = Date.parse(new Date());
 			var values=["shop_id","timestamp"];
			var data={"shop_id":shop_id,"timestamp":timestamp};
			var sign = doSign(values,data);
			var keys="idf5nsi5t0qbemwo12hztbftm53tbv6pht";
			$.ajax({
				type:"post",
				url: link_url+"goodsFilterMenuFromShop",
				dataType: "json",
				data: {"shop_id":shop_id,"key":keys,"timestamp":timestamp,"sign":sign},
				success: function(data) {
				    if(data.status == 1){
				    	console.log("ok");
				    	console.log(data);	
				    	var spec="";
				    	var dataid="";
				    	$.each(data.data,function(i,v){
				    		$('<div class="screening-con-item mm fl" dataid="'+v.id+'">'+v.name+'</div>').appendTo(".top");
				    		$(".screening-con-items").on("click",".screening-con-item",function(){
								$(".screening-con-item").removeClass("active");
								$(".screening-con-item").removeClass("nn");
								$(this).toggleClass("active"); 
								$(this).toggleClass("nn"); 
								console.log($(this).text());
								dataid=$(this).attr("dataid");
								did(dataid);
								
								if(dataid==v['id']){
									var dataid1;
				    				$(".screening-con-b").empty();
				    				$.each(v['spec'], function(x,y) {
				    					$('<div class="screening-con cc" data-attrval="" id="'+y.id+'"><div class="screening-con-title">'+y.name+'</div><div class="screening-con-items1 "><div class="screening-con-item1 mm fl actives nn" dataid="">全部</div></div></div>').appendTo($(".screening-con-b"));
				    					$.each(y.spec_item, function(n,m) {
				    						$('<div class="screening-con-item1 fl mm" dataid="'+m.id+'">'+m.item+'</div>').appendTo($(".cc").eq(x).find(".screening-con-items1"));
				    					});
				    					$('<div class="clear"></div>').appendTo($(".screening-con-items1"));
				    					$(".screening-con-items1").eq(x).on("click",".screening-con-item1",function(){
											$(".screening-con-items1").eq(x).find(".screening-con-item1").removeClass("actives");
											$(this).toggleClass("actives"); 
											$(".screening-con-items1").eq(x).find(".screening-con-item1").removeClass("nn");
											$(this).toggleClass("nn"); 
											console.log($(this).text());
											dataid1=$(this).attr("dataid");
											console.log(dataid1);
										})
				    				});
				    				console.log(dataid);
				    			}
								return dataid;
							})

				    	})
						$(".top").find(".screening-con-item").eq(0).click();
						
						function did(id){
				    		$('.cc').each(function(){
								var i=$(this);
								var p=i.find(".mm");
								console.log(p);
								p.click(function(){
									if($(this).hasClass("nn")){
									}else{
										$(this).addClass("nn");
										i.attr("data-attrval",$(this).attr("dataid"))
										console.log(i);
									}
									var _val='';
									$(".screening-con-b .cc").each(function(x,y){
										if($(y).attr("data-attrval")!= '' &&$(y).attr("data-attrval")!= undefined){	
											var i=$(this);
											var v=i.attr("data-attrval");
											var v1=i.attr("id");
									   		if(v==undefined ||v=='' ){return false;} 
										 	else{var s = v1+"_"+v;_val+=s+'@';}		
										}
									});
									_val =  _val.substring(0,_val.lastIndexOf('@'));
									console.log(_val);
									spec =_val;
									return spec;
	//								shopDetail2(0);
								})
							})
				    	}
				    	$('<div class="clear"></div>').appendTo($(".top"));
				    	$(".btn").click(function(){
//				    		console.log(spec);
//				    		console.log(dataid);
				    		if(dataid==undefined){
				    			console.log(dataid);
								window.location.href="store.html?id="+shop_id+"&spec="+""+"&cat_id="+dataid;
				    		}else{
				    			console.log(spec);
								window.location.href="store.html?id="+shop_id+"&spec="+spec+"&cat_id="+dataid;
				    		}
//				    		 did();
//				    		var arr=[];
//				    		$.each($(".nn"),function(){
//					    		var dataids=$(this).attr("dataid");
//					    		arr.push(dataids);
//					    	});
//					    	console.log(arr);
//					    	var str="";
//							var arrvalue;
//							$.each(arr,function(i,v){
//								arrvalue=arr[i]
//								if(i==0){
//									str+=arr[i];
//								}
//								else{
//									str+="_"+arr[i];
//								}	
//							})
//							console.log(str);
//							console.log(arr.length);
//							if(arr.length<=1){
//								$.toast("至少选择两种属性！","text");
//							}else{
								window.location.href="store.html?id="+shop_id+"&spec="+spec+"&cat_id="+dataid;
//							}
//							
						})
						
				    }else{
				    	 console.log(data);
				    	$.toast(data.data, "text");
				    }
				},error:function(){
				 	console.log(link_url);
				}
			})
		});
		
	</script>
</html>